"use strict";var _slicedToArray=function(){function e(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();window.renderRentViz=function(e){d3.json(e+"/data/landkreise_simplify200.topo.json",function(t){var n=topojson.feature(t,t.objects.landkreise_simplify200);d3.csv(e+"/data/map_data.csv",function(t){var r=t;d3.select("#rents-map").node()&&renderRentMap({geoData:n,data:r}),d3.select("#scatter-plot").node()&&renderScatter(e),d3.select("#comparison-ruhr").node()&&renderComparisonLines(e),d3.select("#comparison-map-2012").node()&&renderComparisonMaps({geoData:n,data:r})})})};var COLORS={11:"#e8e6f2",12:"#b5d3e7",13:"#4fadd0",21:"#e5b4d9",22:"#b8b3d8",23:"#3983bb",31:"#de4fa6",32:"#b03598",33:"#2a1a8a"},YEARS=["2012","2013","2014","2015","2016"],cssNamespace="cor-viz-rents";d3.playbooks.defaults({cssNamespace:cssNamespace});var initialHilight=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Wolfsburg";e.ready().then(function(){var n=e.data().find(function(e){return e.name===t});e.hilight(n),e.control().trigger(riot.EVT.updateSelector,n),e.control().trigger(riot.EVT.updateInfobox,n)})},renderRentMap=function(e){var t=e.geoData,n=e.data,r=d3.playbooks.choroplethMap({width:600,height:810,cssNamespace:cssNamespace,elementId:"rents-map",data:n,geoData:t,responsiveSvg:!0,getId:function(e){return e.properties.RS},color:function(e){return COLORS[e]}}).render().selector({element:"#rents-map-selector",getLabel:function(e){return e.name}}).infobox({element:"#rents-map-infobox",template:"\n        <dl>\n          <dt>{rent_median} € / m²</dt>\n          <dd>Miete 2016</dd>\n          <dt>{percent_change} %</dt>\n          <dd>Anstieg seit 2012</dd>\n        </dl>\n      "}),a=d3.select("#rents-map-timeline");d3.playbooks.timeLineChart.defaults({elementId:"rents-map-timeline",width:150,height:200,curve:d3.curveStep,timeFormat:"%Y",yExtent:[3.5,15],getYAxis:function(e){var t=e.yScale;return d3.axisRight(t)},showXLabel:!1,showYLabel:!1,yTickFormat:function(e){return e>3?e+" €":""},yLabel:"€ / m²",yTicks:3,xTicks:3,margin:{top:20,right:15,bottom:20,left:15}});var o=function(e){a.selectAll("*").remove();var t=[YEARS,YEARS.map(function(t){return Number(e[t])})];d3.playbooks.timeLineChart({data:t,color:COLORS[e.value]}).render()};r.control().on(riot.EVT.updateInfobox,function(e){return o(e)}),initialHilight(r)},renderScatter=function(e){var t=d3.playbooks.scatterChart({elementId:"scatter-plot",dataUrl:e+"/data/scatter.csv",yCol:"rent_median",xLabel:"Einwohner pro km²",yLabel:"Mittlerer Mietpreis pro m²",xCol:"density",getYDomain:function(){return[4,16]},sizeCol:"size",sizeRange:[4,20],groupCol:"color",color:COLORS,yTicks:5,yTickFormat:function(e){return e+" €"},getLegendItems:function(e){var t=e.data,n=d3.extent(t,function(e){return Number(e["2016pop"])}),r=d3.scaleLinear().domain(n).range([4,20]);return[1e5,2e6].reverse().map(function(e){var t=r(e),n=e<1e6?e/1e3+" T.":e/1e6+" Mio.";return{color:COLORS[11],label:n,size:30,radius:t}})}}).render().selector({element:"#scatter-plot-selector",getLabel:function(e){return e.name}}).infobox({element:"#scatter-plot-infobox",template:"\n        <dl>\n          <dt>{rent_median} € / m²</dt>\n          <dd>Miete 2016</dd>\n          <dt>{percent_change} %</dt>\n          <dd>Anstieg seit 2012</dd>\n        </dl>\n      "}).legend({element:"#scatter-plot-legend",wrapperTemplate:"{body}",itemTemplate:'\n        <div class="cor-viz-rents__scatter-legend-item">\n          <svg width="{size}" height="{size}">\n            <circle r={radius} cx=15 cy=15 style="fill:{color}"></circle>\n          </svg>\n          <span>{label}</span>\n        </div>\n      '});initialHilight(t)},renderComparisonLines=function(e){d3.playbooks.multiTimeLineChart.defaults({width:250,height:300,xTicks:3,yTickFormat:function(e){return e>0?e+" €":""},yLabel:"Mittlerer Mietpreis pro m²",timeFormat:"%Y",showXLabel:!1,curve:d3.curveStep,getYDomain:function(){return[0,15]},dataUrl:e+"/data/comparison.csv"}),d3.playbooks.multiTimeLineChart({elementId:"comparison-ruhr",yCols:["Herne","Oberhausen","Essen","Gelsenkirchen","Duisburg","Bochum","Dortmund"],color:COLORS[21]}).render(),d3.playbooks.multiTimeLineChart({elementId:"comparison-muc",yCols:["München","Dachau","Ebersberg","Fürstenfeldbruck","München (Kreis)","Starnberg"],color:COLORS[23],showYLabel:!1}).render()},renderComparisonMaps=function(e){var t=e.geoData,n=e.data,r=function(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=d3.playbooks.choroplethMap({width:600,height:810,cssNamespace:cssNamespace,elementId:"comparison-map-"+e,yCol:e,yExtent:[5,15],data:n,geoData:t,responsiveSvg:!0,getId:function(e){return e.properties.RS},hilightNode:function(){},color:[COLORS[11],COLORS[12],COLORS[13],COLORS[23],COLORS[33]],drawExtra:function(e){var t=e.g,n=e.data,r=e.path,a=n.find(function(e){return"Wolfsburg"===e.name}),o=r.centroid(a),i=_slicedToArray(o,2),s=i[0],l=i[1];t.append("g").append("circle").attr("r",20).style("fill-opacity",0).style("stroke","black").attr("cx",s).attr("cy",l)}}).render();r&&a.legend({element:"#comparison-maps-legend",wrapperTemplate:'\n          <ul class="'+cssNamespace+'__legend-list">\n            {body}\n            <li class="-wb"><svg width="12" height="12"><circle r="5" cx="6" cy="6" fill-opacity="0" stroke="gray" /></svg> Wolfsburg</li>\n          </ul>\n        ',itemTemplate:'<li><span style="background-color:{color}"></span>{label}&nbsp;€</li>'})};r(2012),r(2016,!1)};
